# 语义分析单元测试
通过分析两个已知补丁函数，查看分析结果。

## 1.在ida中运行脚本
通过脚本将节点关系和汇编码写入到文件中

## 2.写入数据库
通过脚本将节点关系和汇编码写入到数据库

## 3.构造graph

## 4.添加测试partial_trace

## 5.测试semantic


ps:工作重点转向partial_trace
从多维度比较基本块的相似度
- 大小
- 语句提取 (助记符、操作数类型)
- 函数调用特征
- 出度入度
前三个各设置不同权重  pow_size, pow_mnem, pow_optype, pow_call
最后一个用于比较相似与相同

size比较：
    1 - abs(size_p - size_o)/size_o
mnem比较：

参考对应
f       g
0       0
1       1
2       2-3-4-7
3       5
4       6
5       8
6       9
7       10
8       11
9       12
10      13
11      14


余弦相似度
  f  g  sim
[(0, 0, 0.9485040136686709),
 (1, 1, 0.9999999999999999),
 (2, 12, 0.8164965809277259),    相似度低
 (3, 12, 1.0000000000000002),    对应错误   BNE  与 BEQ无法区分
 (4, 6, 0.9999999999999998),
 (5, 8, 0.9971862217459626),
 (6, 9, 1.0000000000000002),
 (7, 10, 1.0000000000000002),
 (8, 11, 1.0),
 (9, 12, 1.0000000000000002),
 (10, 13, 1.0000000000000002),
 (11, 14, 1.0000000000000002)]

 修改顺序比较后
 [(0, 0, 0.9485040136686709),
 (1, 1, 0.9999999999999999),
 (2, 4, 0.8164965809277259),    相似度低
 (3, 5, 1.0000000000000002),
 (4, 6, 0.9999999999999998),
 (5, 8, 0.9971862217459626),
 (6, 4, 1.0000000000000002),   对应错误
 (7, 10, 1.0000000000000002),
 (8, 11, 1.0),
 (9, 5, 1.0000000000000002),    对应错误   BNE  与 BEQ无法区分
 (10, 13, 1.0000000000000002),
 (11, 14, 1.0000000000000002)]

应当在比较的过程中确定出 相应对后， 标记已经比较的
同时应当注意相应对之间的关系
权重传递？

增加候选 阈值 函数调用序列
[[(0, 0, 0.9485040136686709), (0, 13, 0.9415130835240085)],
 [(1, 1, 0.9999999999999999), (1, 10, 0.9851380077988758)],
 [],
 [(3, 5, 1.0000000000000002),
  (3, 7, 1.0000000000000002),
  (3, 12, 1.0000000000000002)],
 [(4, 6, 0.9999999999999998)],
 [(5, 8, 0.9971862217459626)],
 [(6, 4, 1.0000000000000002), (6, 9, 1.0000000000000002)],
 [(7, 10, 1.0000000000000002), (7, 1, 0.9851380077988758)],
 [(8, 11, 1.0)],
 [(9, 5, 1.0000000000000002),
  (9, 7, 1.0000000000000002),
  (9, 12, 1.0000000000000002)],
 [(10, 13, 1.0000000000000002),
  (10, 2, 0.9434563530497265),
  (10, 3, 0.9245003270420487)],
 [(11, 14, 1.0000000000000002)]]

 加入 大小
 [[(0, 13, 0.9621567374083244),
  (0, 0, 0.9567952677167193),
  (0, 2, 0.944353877147237)],
 [(1, 1, 0.9999999999999998), (1, 10, 0.9967269150922087)],
 [(2, 4, 0.9444444444444444),
  (2, 5, 0.9444444444444444),
  (2, 7, 0.9444444444444444)],
 [(3, 5, 0.960768922830523),
  (3, 7, 0.960768922830523),
  (3, 12, 0.960768922830523)],
 [(4, 6, 0.984731927834662)],
 [],
 [(6, 4, 0.9819805060619657),
  (6, 9, 0.9819805060619657),
  (6, 2, 0.9354143466934852)],
 [],
 [(8, 11, 0.9272418371079396)],
 [(9, 5, 1.0000000000000002),
  (9, 7, 1.0000000000000002),
  (9, 12, 1.0000000000000002)],
 [(10, 13, 0.9955287824182676),
  (10, 3, 0.9886553857403927),
  (10, 2, 0.9845886926107882)],
 [(11, 14, 0.9538209664765318)]]

再加入optype
[[(0, 13, 0.9910081668184008),
  (0, 0, 0.9891979116696802),
  (0, 3, 0.9696214783568685)],
 [(1, 1, 1.0), (1, 10, 0.9980973032872256)],
 [(2, 5, 0.9456108576893003),
  (2, 7, 0.9456108576893003),
  (2, 12, 0.9456108576893003)],
 [(3, 5, 1.0), (3, 7, 1.0), (3, 12, 1.0)],
 [(4, 6, 1.0)],
 [(5, 8, 0.9995437082102522)],
 [(6, 4, 0.9999999999999998),
  (6, 9, 0.9999999999999998),
  (6, 2, 0.9723794007404222)],
 [(7, 10, 1.0000000000000002), (7, 1, 0.9980973032872256)],
 [(8, 11, 1.0)],
 [(9, 5, 1.0), (9, 7, 1.0), (9, 12, 1.0)],
 [(10, 13, 1.0), (10, 3, 0.9833008967924902), (10, 0, 0.9809105840389973)],
 [(11, 14, 1.0)]]

再加入degree
[[(0, 0, 0.9879250549501016),
  (0, 13, 0.9851291306452356),
  (0, 3, 0.9648563831155126)],
 [(1, 1, 1.0000000000000002), (1, 10, 0.9980678856056105)],
 [(2, 5, 0.9037378388935389),
  (2, 7, 0.9037378388935389),
  (2, 12, 0.9037378388935389)],
 [(3, 5, 1.0000000000000002),
  (3, 7, 1.0000000000000002),
  (3, 12, 1.0000000000000002)],
 [(4, 6, 0.9772545497599154)],
 [(5, 8, 0.9995415770745886)],
 [(6, 4, 1.0000000000000002),
  (6, 9, 1.0000000000000002),
  (6, 2, 0.9621023987294833)],
 [(7, 10, 1.0), (7, 1, 0.9980678856056105)],
 [(8, 11, 0.9999999999999999)],
 [(9, 5, 1.0000000000000002),
  (9, 7, 1.0000000000000002),
  (9, 12, 1.0000000000000002)],
 [(10, 13, 1.0), (10, 3, 0.9838400021138252), (10, 0, 0.9777922224250577)],
 [(11, 14, 1.0)]]


 修改mnem_list
 [[(0, 0, 0.9760521327937723),
  (0, 13, 0.9748271358690321),
  (0, 3, 0.9539595726461607)],
 [(1, 1, 1.0000000000000002), (1, 10, 0.9980678856056105)],
 [(2, 5, 0.9037378388935389)],
 [(3, 5, 1.0000000000000002),
  (3, 12, 0.9615384615384617),
  (3, 7, 0.9230769230769232)],
 [(4, 6, 0.9772545497599154)],
 [(5, 8, 0.9995415770745886)],
 [(6, 9, 1.0000000000000002),
  (6, 4, 0.9583333333333335),
  (6, 2, 0.9367839145523917)],
 [(7, 10, 1.0), (7, 1, 0.9980678856056105)],
 [(8, 11, 0.9999999999999999)],
 [(9, 12, 1.0000000000000002),
  (9, 5, 0.9615384615384617),
  (9, 7, 0.9230769230769232)],
 [(10, 13, 1.0000000000000002),
  (10, 3, 0.9705559666628853),
  (10, 0, 0.9409018319549184)],
 [(11, 14, 1.0)]]
